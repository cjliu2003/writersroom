/**
 * Screenplay Formatting Styles
 *
 * Industry-standard screenplay formatting for TipTap editor.
 * Measurements use millimeters (mm) to match pagination extension units.
 *
 * Positioning is relative to the page left margin (1.5" = 38.1mm),
 * which is already set by the pagination extension.
 */

/* Global Screenplay Editor Styles */
.screenplay-editor {
  font-family: var(--font-courier-prime), 'Courier Prime', 'Courier New', monospace;
  font-size: 12pt;
  line-height: 12pt;  /* Match Final Draft's 6 lines per inch (12pt baseline-to-baseline) */
  letter-spacing: -0.02em;  /* Tighten characters to match Final Draft's rendering */
  color: #000;
  background: #fff;
}

/* Remove default margins from all screenplay elements */
.screenplay-editor p {
  margin: 0;
}

/* Scene Heading (Slug Line) */
.screenplay-editor .screenplay-scene-heading,
.screenplay-editor [data-type="scene-heading"] {
  margin-left: 0 !important; /* Flush with left margin */
  max-width: none !important;
  text-transform: uppercase;
  /* Note: Scene headings are NOT bold in standard screenplay format */
  margin-top: 24pt !important; /* Double-space before */
  margin-bottom: 12pt !important; /* Single-space after */
}

/* First element on each page should not have top margin.
 * [data-rm-pagination] is inserted by PaginationPlus at position 0 with side: -1,
 * AFTER .rm-first-page-header (side: -2). So this rule targets:
 * - Page 1: The first content element (scene heading, action, etc.)
 * - Pages 2+: The first content element after each page break
 * Without this, scene headings would add 24pt (32px) margin pushing content down.
 */
.screenplay-editor [data-rm-pagination] + * {
  margin-top: 0 !important;
}

/* Action (Scene Description) */
.screenplay-editor .screenplay-action,
.screenplay-editor [data-type="action"] {
  margin-left: 0 !important; /* Flush with left margin */
  max-width: none !important;
  margin-bottom: 12pt !important; /* Single-space after */
  /* line-height inherited from .screenplay-editor */
}

/* Character Name (Character Cue) */
.screenplay-editor .screenplay-character,
.screenplay-editor [data-type="character"] {
  /* Standard: 3.7" from page left edge = 2.2" from 1.5" left margin */
  /* 2.2" = 55.88mm additional indent */
  /* !important needed to override Tailwind prose styles */
  width: fit-content !important;
  max-width: none !important;
  margin-left: 50.5mm !important; /* ~3.5" from page left edge */
  margin-right: auto !important;
  text-transform: uppercase;
  margin-top: 12pt !important; /* Single-space before */
  margin-bottom: 0 !important; /* No space after (dialogue follows immediately) */
}

/* Dialogue */
.screenplay-editor .screenplay-dialogue,
.screenplay-editor [data-type="dialogue"] {
  /* Standard: 2.5" from page left edge = 1.0" from 1.5" left margin */
  /* Width adjusted from 88.9mm (3.5") to 86mm to compensate for letter-spacing: -0.02em */
  /* This ensures exactly 35 characters per line, matching Final Draft */
  /* !important needed to override Tailwind prose styles */
  width: 88.5mm !important; /* ~335px for 35 chars with letter-spacing */
  max-width: 88.5mm !important;
  margin-left: 25.4mm !important; /* 2.5" from page left edge */
  margin-right: 63.9mm !important; /* adjusted for 88.5mm width */
  margin-bottom: 12pt !important; /* Single-space after */
}

/* Dialogue followed by parenthetical should have no bottom margin */
.screenplay-editor .screenplay-dialogue:has(+ .screenplay-parenthetical),
.screenplay-editor .screenplay-dialogue:has(+ [data-type="parenthetical"]),
.screenplay-editor [data-type="dialogue"]:has(+ .screenplay-parenthetical),
.screenplay-editor [data-type="dialogue"]:has(+ [data-type="parenthetical"]) {
  margin-bottom: 0 !important;
}

/* Parenthetical */
.screenplay-editor .screenplay-parenthetical,
.screenplay-editor [data-type="parenthetical"] {
  /* Final Draft standard: 27 characters per line including parentheses */
  /* 27 chars รท 10 chars/inch = 2.7 inches = 68.58mm width */
  /* !important needed to override Tailwind prose styles */
  width: 65mm !important; /* ~246px for 27 chars with letter-spacing */
  max-width: 65mm !important;
  margin-left: 35.75mm !important; /* ~2.9" from page left edge */
  margin-right: 89.83mm !important; /* adjusted for 65mm width */
  font-style: normal; /* NOT italic - standard screenplay format */
  margin-top: 0 !important; /* No space before (follows character/dialogue immediately) */
  margin-bottom: 0 !important; /* No space after (dialogue follows immediately) */
}

/* Parentheses are now real text characters in the document, not CSS pseudo-elements.
   This allows users to edit/delete parentheses like normal text. */

/* Transition */
.screenplay-editor .screenplay-transition,
.screenplay-editor [data-type="transition"] {
  text-align: right !important;
  text-transform: uppercase;
  max-width: none !important;
  margin-top: 12pt !important; /* Single-space before */
  margin-bottom: 12pt !important; /* Single-space after */
}

/* Auto-add colon to transitions */
.screenplay-editor .screenplay-transition::after,
.screenplay-editor [data-type="transition"]::after {
  content: ':';
}

/* Collaboration Cursor Styling (preserve from POC) */
.collaboration-cursor__caret {
  position: relative;
  margin-left: -1px;
  margin-right: -1px;
  border-left: 1px solid;
  border-right: 1px solid;
  word-break: normal;
  pointer-events: none;
}

.collaboration-cursor__label {
  position: absolute;
  top: -1.4em;
  left: -1px;
  font-size: 12px;
  font-style: normal;
  font-weight: 600;
  line-height: normal;
  user-select: none;
  color: #fff;
  padding: 0.1rem 0.3rem;
  border-radius: 3px 3px 3px 0;
  white-space: nowrap;
}

/* Ensure ProseMirror focus styles don't interfere */
.screenplay-editor .ProseMirror:focus {
  outline: none;
}

/* Placeholder styling for empty elements */
.screenplay-editor .ProseMirror p.is-editor-empty:first-child::before {
  color: #adb5bd;
  content: attr(data-placeholder);
  float: left;
  height: 0;
  pointer-events: none;
}

/* Page break styling (from pagination extension) */
.screenplay-editor .page-break {
  border-top: 2px dashed #ccc;
  margin: 2rem 0;
  padding-top: 2rem;
  page-break-after: always;
}
