// /extensions/screenplay/SceneHeading.ts
import { Node, mergeAttributes } from '@tiptap/core'
import { textblockTypeInputRule } from '@tiptap/core' // re-exported from prosemirror-inputrules

export const SceneHeading = Node.create({
  name: 'scene_heading',
  group: 'block',
  content: 'inline*',
  defining: true,

  parseHTML() {
    return [{ tag: 'p[data-type="scene-heading"]' }]
  },

  renderHTML({ HTMLAttributes }) {
    return ['p', mergeAttributes(HTMLAttributes, { 'data-type': 'scene-heading', class: 'scn-heading' }), 0]
  },

  addKeyboardShortcuts() {
    return {
      'Mod-1': () => this.editor.commands.setNode(this.name),
    }
  },

  addInputRules() {
    // If line starts with "INT." or "EXT." â†’ convert to scene heading
    return [
      textblockTypeInputRule({
        find: /^(INT\.|EXT\.|EST\.|INT\/EXT\.)\s.*$/,
        type: this.type,
      }),
    ]
  },
})
